<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Raffaele Vacca, bewerking Harrie Jonkman">

<title>Introductie op multilevel analyse in R met lme4 en tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introductie op multilevel analyse in R met lme4 en tidyverse</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Raffaele Vacca, bewerking Harrie Jonkman </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introductie" class="level2">
<h2 class="anchored" data-anchor-id="introductie">Introductie</h2>
<p>Ik had al een tijdje geen multilevel-analyses meer gedaan en wilde dat weer eens doen met aangepaste technieken. Ben zelf ‘opgeleid’ met het prachtige werk van de multilevelgroep uit Bristol (Goldstein, Rabash, Brown e.a.) en ook dat van Joop Hox, die ik op dit gebied van dichtbij heb meegemaakt. Toen ik wat rondkeek, kwam ik de blog van Rafaella Vacca (Universiteit van Milaan) tegen, die ik inzichtelijk en vernieuwend vond. Hij werkt met het pakket <code>lme4</code> en <code>tidyverse</code>. Hieronder vind je mijn bewerkte versie. Dank je wel Rafaella.</p>
<p><br></p>
<p><strong>Laten we beginnen:</strong> * Dit is een introductie op multilevel analyse met R voor de seminars die Raffaele Vacca eerder gaf op de <a href="https://www.nasp.eu/training/phd-programmes/esls.html">UniMi NASP graduate school</a> en <a href="https://behavelab.org/">Behave Lab</a>. * <a href="https://github.com/raffaelevacca/Intro-multilevel-with-R">Hier</a> staat het materiaal dat je via (GitHub) kunt downloaden.</p>
<p><strong>R pakketten en literatuur</strong>:</p>
<ul>
<li>Deze tutorial richt zich op (1) het <a href="https://github.com/lme4/lme4"><code>lme4</code></a> pakket voor (Restricted) Maximum Likelihood Estimation van lineaire multilevel modellen <span class="citation" data-cites="bates_fitting_2015 bates_lme4_2012">(<a href="#ref-bates_fitting_2015" role="doc-biblioref">Bates et al. 2015</a>; <a href="#ref-bates_lme4_2012" role="doc-biblioref">Bates 2012</a>)</span> en (2) integreren van <code>lme4</code> met <a href="https://www.tidyverse.org/"><code>tidyverse</code></a>, een verzameling van R pakketten voor data wetenschap (waaronder <code>dplyr</code>, <code>ggplot2</code>, en <code>purrr</code>) met een gezamenlijke taal en een set van principles <span class="citation" data-cites="wickham_r_2017">(<a href="#ref-wickham_r_2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>.</li>
<li>Het is gebaseerd op de discussie ‘(linear) multilevel modeling’ van <span class="citation" data-cites="fox_fitting_2018">Fox and Weisberg (<a href="#ref-fox_fitting_2018" role="doc-biblioref">2018</a>)</span> en <span class="citation" data-cites="fox_linear_2016">Fox (<a href="#ref-fox_linear_2016" role="doc-biblioref">2016b</a>)</span>. Het voorbeeld dat hier gebruikt wordt komt oorspronkelijk van <span class="citation" data-cites="raudenbush_hierarchical_2002">Raudenbush and Bryk (<a href="#ref-raudenbush_hierarchical_2002" role="doc-biblioref">2002</a>)</span>. Een deel van de code is ook geïnsprieerd door Wickham and Grolemund’s <span class="citation" data-cites="wickham_r_2017">(<a href="#ref-wickham_r_2017" role="doc-biblioref">2017</a>)</span> behandeling van statististisch modeleren met R (vooral Hfd. 20).</li>
<li>De data komen van <a href="https://rdrr.io/cran/nlme/man/MathAchieve.html"><code>MathAchieve</code></a> en <a href="https://rdrr.io/cran/nlme/man/MathAchSchool.html"><code>MathAchSchool</code></a> data-frames in het <a href="https://cran.r-project.org/web/packages/nlme/index.html"><code>nlme</code></a> pakket. Daar komen ze weer via het “High School and Beyond” onderzoek met 7185 studenten in 160 V.S. middelbare scholen, inclusief 70 Katholieke en 90 Openbare scholen <span class="citation" data-cites="fox_linear_2016 raudenbush_hierarchical_2002">(<a href="#ref-fox_linear_2016" role="doc-biblioref">Fox 2016b</a>; <a href="#ref-raudenbush_hierarchical_2002" role="doc-biblioref">Raudenbush and Bryk 2002</a>)</span>. Kijk naar de links en referenties hierboven als je meer documentatie zoekt voor deze data.</li>
</ul>
<p><strong>Nog wat litertuur en bronnen</strong>:</p>
<ul>
<li>Voor statistische theorie, details over schattingmethodes en, meer gedetailleerd, behandeling van multilevel modelellen die in deze introductie worden behandeld (in chronologische volgorde): <span class="citation" data-cites="raudenbush_hierarchical_2002">Raudenbush and Bryk (<a href="#ref-raudenbush_hierarchical_2002" role="doc-biblioref">2002</a>)</span>; <span class="citation" data-cites="gelman_data_2006">Gelman and Hill (<a href="#ref-gelman_data_2006" role="doc-biblioref">2006</a>)</span>; <span class="citation" data-cites="rasbash_lemma_2008">Rasbash, Steele, and Reckie (<a href="#ref-rasbash_lemma_2008" role="doc-biblioref">2008</a>)</span>; <span class="citation" data-cites="goldstein_multilevel_2010">Goldstein (<a href="#ref-goldstein_multilevel_2010" role="doc-biblioref">2010</a>)</span>; <span class="citation" data-cites="snijders_multilevel_2012">Snijders and Bosker (<a href="#ref-snijders_multilevel_2012" role="doc-biblioref">2012</a>)</span>; <span class="citation" data-cites="simonoff_sage_2013">Simonoff, Scott, and Marx (<a href="#ref-simonoff_sage_2013" role="doc-biblioref">2013</a>)</span>; <span class="citation" data-cites="fox_applied_2016">Fox (<a href="#ref-fox_applied_2016" role="doc-biblioref">2016a</a>)</span> (Ch. 23-24).</li>
<li>Voor meer informatie over de R-implementatie van multilevel modellen, inclusief verschillende pakketten en schattingsmethodes: <span class="citation" data-cites="finch_multilevel_2014">Finch, Bolin, and Kelley (<a href="#ref-finch_multilevel_2014" role="doc-biblioref">2014</a>)</span>; <span class="citation" data-cites="fox_fitting_2018">Fox and Weisberg (<a href="#ref-fox_fitting_2018" role="doc-biblioref">2018</a>)</span>; <a href="https://math.mcmaster.ca/~bolker/">Ben Bolker</a>‘s <a href="http://bbolker.github.io/mixedmodels-misc/glmmFAQ.html#introduction">FAQ page</a> over ’Generalized Linear Mixed Models’.</li>
</ul>
</section>
<section id="set-up-instructies" class="level2">
<h2 class="anchored" data-anchor-id="set-up-instructies">Set-up instructies</h2>
<p>Voor deze workshop is het nodig dat je:</p>
<ol type="1">
<li>Dat je de laatste versie binnenhaalt van <strong>R</strong> <a href="https://cran.r-project.org/mirrors.html">hier</a> (selecteer een locatie bij je in de buurt).
<ul>
<li>Volg de instructies om R op jouw computer te installeren.</li>
</ul></li>
<li>Download <strong>RStudio</strong> (vrije versie) <a href="https://www.rstudio.com/products/rstudio/download/">hier</a>.
<ul>
<li>Volg de instructies om RStudio op jouw computer te installeren.</li>
</ul></li>
<li>Installeer de <strong>R pakkettem</strong> genoemd <a href="#packages">onder</a>.
<ul>
<li>Open RStudio en ga naar<code>Top menu &gt; Tools &gt; Install packages...</code>.</li>
<li>Installeer elk pakket van de lijst.</li>
</ul></li>
<li>Breng de <strong>laptop</strong> mee naar de workshop.</li>
<li>Download de <strong>workshop project folder</strong> <a href="https://github.com/raffaelevacca/Intro-multilevel-with-R">hier</a>
<ul>
<li>Klik op de link &gt; Klik op de groene <code>Clone</code> knop &gt; Download ZIP &gt; Dan ‘unzip’ de folder op jouw computer.</li>
<li>Ga naar de workshop project folder en dubbelklik op de workshop R project file (<code>Multilevel_with_R.Rproj</code>). Dit zal RStudio openen.</li>
</ul></li>
</ol>
</section>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Vereiste R pakketten</h2>
<ul>
<li>Algemeen:
<ul>
<li><a href="https://broom.tidymodels.org/"><code>broom</code></a> om de model resultaten als tidy tibbles te zien.<br>
</li>
<li><a href="https://magrittr.tidyverse.org/"><code>magrittr</code></a> voor ‘pipe’ en gerelateerde handelingen.<br>
</li>
<li><a href="https://www.tidyverse.org/"><code>tidyverse</code></a> voor data-bewerking.<br>
</li>
</ul></li>
<li>Om multilevel modellen te draaien en de resultaten te zien:
<ul>
<li><a href="https://cran.r-project.org/web/packages/broom.mixed/vignettes/broom_mixed_intro.html"><code>broom.mixed</code></a>.<br>
</li>
<li><a href="https://cran.r-project.org/web/packages/car/index.html"><code>car</code></a> voor testen van significantie.<br>
</li>
<li><a href="https://strengejacke.github.io/ggeffects/"><code>ggeffects</code></a> om de geschatte waarden (‘predicted values’) te berekenen en te visualiseren.<br>
</li>
<li><a href="https://github.com/lme4/lme4"><code>lme4</code></a> voor specificeren en schatten van multilevel modellen.<br>
</li>
<li><a href="https://www.jstatsoft.org/article/view/v082i13"><code>lmerTest</code></a> voor testen van significatie van multilevel modellen.</li>
</ul></li>
</ul>
</section>
<section id="exploreren-en-voorbereiden-van-data" class="level1">
<h1>Exploreren en voorbereiden van data</h1>
<ul>
<li>Importeren en bekijken van de data in R.</li>
<li>Verkrijgen van basis informatie over de multilevel structuur van de data.</li>
<li>Onze afhankelijke variabele is de student’s score op wiskunde toets (‘math assessment’ (<code>mathach</code>).</li>
<li>Onafhankelijke variabelen:
<ul>
<li>Student karakteristieken: score op sociaal-economische status (SES), in afwijking van het school SES gemiddelde (<code>ses.dev</code>).</li>
<li>School karakteristieken: gemiddelde van de school-SES (<code>mean.ses</code>) en de school type/sector (Public vs Catholic, <code>sector</code>).</li>
</ul></li>
</ul>
<p>Pakketten actief maken (zie code, niet in dit bestand zichtbaar).</p>
<p>Vervolgens de data laden.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"multilevel_data.rda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Laten we de data eens bekijken.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>stud_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,185 × 5
   school minority sex       ses mathach
   &lt;chr&gt;  &lt;fct&gt;    &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 1224   No       Female -1.53    5.88 
 2 1224   No       Female -0.588  19.7  
 3 1224   No       Male   -0.528  20.3  
 4 1224   No       Male   -0.668   8.78 
 5 1224   No       Male   -0.158  17.9  
 6 1224   No       Male    0.022   4.58 
 7 1224   No       Female -0.618  -2.83 
 8 1224   No       Male   -0.998   0.523
 9 1224   No       Female -0.888   1.53 
10 1224   No       Male   -0.458  21.5  
# … with 7,175 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>school_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 2
   school sector  
 * &lt;chr&gt;  &lt;fct&gt;   
 1 1224   Public  
 2 1288   Public  
 3 1296   Public  
 4 1308   Catholic
 5 1317   Catholic
 6 1358   Public  
 7 1374   Public  
 8 1433   Catholic
 9 1436   Catholic
10 1461   Public  
# … with 150 more rows</code></pre>
</div>
</div>
</section>
<section id="hoeveel-scholen-zitten-erin" class="level1">
<h1>Hoeveel scholen zitten erin?</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>stud_data <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(school) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  n_distinct</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 160</code></pre>
</div>
</div>
</section>
<section id="hoeveel-studenten-zitten-er-op-iedere-school-school-omvang" class="level1">
<h1>Hoeveel studenten zitten er op iedere school (school-omvang)?</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>stud_data <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(school)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 2
   school     n
   &lt;chr&gt;  &lt;int&gt;
 1 1224      47
 2 1288      25
 3 1296      48
 4 1308      20
 5 1317      48
 6 1358      30
 7 1374      28
 8 1433      35
 9 1436      44
10 1461      33
# … with 150 more rows</code></pre>
</div>
</div>
</section>
<section id="sorteer-het-op-school-omvang" class="level1">
<h1>Sorteer het op school-omvang</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>stud_data <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(school, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 2
   school     n
   &lt;chr&gt;  &lt;int&gt;
 1 2305      67
 2 5619      66
 3 4292      65
 4 3610      64
 5 4042      64
 6 8857      64
 7 4530      63
 8 1477      62
 9 2277      61
10 4642      61
# … with 150 more rows</code></pre>
</div>
</div>
</section>
<section id="wat-is-de-gemiddelde-school-omvang" class="level1">
<h1>Wat is de gemiddelde school-omvang?</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>stud_data <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(school) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">mean</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  `mean(n)`
      &lt;dbl&gt;
1      44.9</code></pre>
</div>
</div>
</section>
<section id="bereken-het-gemiddelde-student-ses-op-elke-school" class="level1">
<h1>Bereken het gemiddelde student-SES op elke school</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>stud_data <span class="sc">%&lt;&gt;%</span>                      <span class="co"># Gebruik marittr %&lt;&gt;% operator: pipe + bereken</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(school) <span class="sc">%&gt;%</span>              <span class="co"># Groepeer data frame per school voor mutate </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean.ses=</span> <span class="fu">mean</span>(ses)) <span class="sc">%&gt;%</span>   <span class="co"># Creeer mean(ses) per school</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  ungroup                           <span class="co"># Ungroup data frame</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>stud_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,185 × 6
   school minority sex       ses mathach mean.ses
   &lt;chr&gt;  &lt;fct&gt;    &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
 1 1224   No       Female -1.53    5.88    -0.434
 2 1224   No       Female -0.588  19.7     -0.434
 3 1224   No       Male   -0.528  20.3     -0.434
 4 1224   No       Male   -0.668   8.78    -0.434
 5 1224   No       Male   -0.158  17.9     -0.434
 6 1224   No       Male    0.022   4.58    -0.434
 7 1224   No       Female -0.618  -2.83    -0.434
 8 1224   No       Male   -0.998   0.523   -0.434
 9 1224   No       Female -0.888   1.53    -0.434
10 1224   No       Male   -0.458  21.5     -0.434
# … with 7,175 more rows</code></pre>
</div>
</div>
<p>Laat de student’s SES-afwijking van het school-gemiddelde zien.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(stud_data <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ses.dev =</span> ses <span class="sc">-</span> mean.ses))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,185 × 7
   school minority sex       ses mathach mean.ses ses.dev
   &lt;chr&gt;  &lt;fct&gt;    &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
 1 1224   No       Female -1.53    5.88    -0.434 -1.09  
 2 1224   No       Female -0.588  19.7     -0.434 -0.154 
 3 1224   No       Male   -0.528  20.3     -0.434 -0.0936
 4 1224   No       Male   -0.668   8.78    -0.434 -0.234 
 5 1224   No       Male   -0.158  17.9     -0.434  0.276 
 6 1224   No       Male    0.022   4.58    -0.434  0.456 
 7 1224   No       Female -0.618  -2.83    -0.434 -0.184 
 8 1224   No       Male   -0.998   0.523   -0.434 -0.564 
 9 1224   No       Female -0.888   1.53    -0.434 -0.454 
10 1224   No       Male   -0.458  21.5     -0.434 -0.0236
# … with 7,175 more rows</code></pre>
</div>
</div>
<p>Laten we de twee datasets combineren.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(stud_data, school_data, <span class="at">by=</span><span class="st">"school"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,185 × 8
   school minority sex       ses mathach mean.ses ses.dev sector
   &lt;chr&gt;  &lt;fct&gt;    &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt; 
 1 1224   No       Female -1.53    5.88    -0.434 -1.09   Public
 2 1224   No       Female -0.588  19.7     -0.434 -0.154  Public
 3 1224   No       Male   -0.528  20.3     -0.434 -0.0936 Public
 4 1224   No       Male   -0.668   8.78    -0.434 -0.234  Public
 5 1224   No       Male   -0.158  17.9     -0.434  0.276  Public
 6 1224   No       Male    0.022   4.58    -0.434  0.456  Public
 7 1224   No       Female -0.618  -2.83    -0.434 -0.184  Public
 8 1224   No       Male   -0.998   0.523   -0.434 -0.564  Public
 9 1224   No       Female -0.888   1.53    -0.434 -0.454  Public
10 1224   No       Male   -0.458  21.5     -0.434 -0.0236 Public
# … with 7,175 more rows</code></pre>
</div>
</div>
<p>Maak van de variabele <code>school</code> een factor (een categoriale variabele zeg maar) en vergelijk N-scholen van <code>school_data</code> en N-studenten van <code>df</code> met elkaar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">school =</span> <span class="fu">factor</span>(school))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequenties van school sector: </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># N scholen</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>school_data <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sector)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  sector       n
  &lt;fct&gt;    &lt;int&gt;
1 Public      90
2 Catholic    70</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># N studenten</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sector)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  sector       n
  &lt;fct&gt;    &lt;int&gt;
1 Public    3642
2 Catholic  3543</code></pre>
</div>
</div>
<p>Dus, zo konden we antwoorden vinden op vragen als: * <em>Hoeveel studenten en scholen zitten er in de data?</em> * <em>Wat is gemiddelde aantal studenten per school?</em> * <em>Hoeveel zijn er Katholiek, hoeveel openbaar?</em></p>
</section>
<section id="analyses-per-school-scatter-plots" class="level1">
<h1>Analyses per school: scatter-plots</h1>
<p>Nu we een algemeen beeld hebben van de dataset, gaan we vervolgens kijken wat we over individuele scholen kunnen zeggen.</p>
<p>Wat je nu moet doen: * Maak een kleine dataset van een random sample van 20 Katholieke scholen en 20 Openbare scholen. * Maak een scatter-plot van de student wiskunde score per student_SES in elke school, voor de subsample Katholieke en Openbare scholen.</p>
<p>Eerst een sample van katholieke scholen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1129</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>school.IDs <span class="ot">&lt;-</span> school_data <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sector<span class="sc">==</span><span class="st">"Catholic"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(school)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>school.IDs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "5667" "4223" "9198" "4253" "5650" "8150" "5761" "2658" "3838" "8193"
[11] "4292" "7364" "3992" "5404" "5192" "1462" "4042" "3020" "7172" "1477"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data op juist deze school IDs</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>(df.cat <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(school <span class="sc">%in%</span> school.IDs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,011 × 8
   school minority sex      ses mathach mean.ses ses.dev sector  
   &lt;fct&gt;  &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;   
 1 1462   Yes      Male   0.162    1.97   -0.669  0.831  Catholic
 2 1462   Yes      Male  -0.758    7.72   -0.669 -0.0886 Catholic
 3 1462   Yes      Male  -0.708   19.0    -0.669 -0.0386 Catholic
 4 1462   Yes      Male  -0.818   20.1    -0.669 -0.149  Catholic
 5 1462   Yes      Male  -1.92    22.3    -0.669 -1.25   Catholic
 6 1462   Yes      Male  -0.948   14.3    -0.669 -0.279  Catholic
 7 1462   Yes      Male  -0.798   10.2    -0.669 -0.129  Catholic
 8 1462   Yes      Male  -1.46     9.61   -0.669 -0.789  Catholic
 9 1462   Yes      Male  -0.158    6.12   -0.669  0.511  Catholic
10 1462   Yes      Male  -0.378   23.8    -0.669  0.291  Catholic
# … with 1,001 more rows</code></pre>
</div>
</div>
<p>We kunnen alles in een enkele pipe zetten om een korere code te hebben.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1129</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>df.cat <span class="ot">&lt;-</span> school_data <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sector<span class="sc">==</span><span class="st">"Catholic"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(school) <span class="sc">%&gt;%</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">filter</span>(df, school <span class="sc">%in%</span> .)} <span class="co"># Let op {} haakjes zodat "." niet als eerste argument in de filter() wordt gebruikt</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Doe hetzelfde voor de Openbare scholen</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1129</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>df.pub <span class="ot">&lt;-</span> school_data <span class="sc">%&gt;%</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sector<span class="sc">==</span><span class="st">"Public"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(school) <span class="sc">%&gt;%</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">filter</span>(df, school <span class="sc">%in%</span> .)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot SES vs wisk score in elk van 20 Katholieke scholen</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data en variabelen</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df.cat, <span class="fu">aes</span>(<span class="at">x=</span>ses.dev, <span class="at">y=</span>mathach)) <span class="sc">+</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Scatterplot geom</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># voeg een lineaire regressioe lijn toe</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">color=</span> <span class="st">"red"</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Facet per school</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> school, <span class="at">nrow=</span><span class="dv">4</span>, <span class="at">ncol=</span><span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Zwart/wit thema</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Bekijk de plot</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Zelfde als hierboven maar nu voor Openbare scholen</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.pub, <span class="fu">aes</span>(<span class="at">x=</span>ses.dev, <span class="at">y=</span>mathach)) <span class="sc">+</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Scatterplot geom</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rode lineaire regressie lijn</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">color=</span> <span class="st">"red"</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Facet per school</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> school, <span class="at">nrow=</span><span class="dv">4</span>, <span class="at">ncol=</span><span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Zwart/wit thema</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li><em>Wat valt je op over intercept en slope als je naar de plaatjes kijkt? Zijn ze constant over de scholen? </em></li>
<li><em>Wat van soort relatie zie je in het algemeen tussen students-SES en z’n wiskundescore in de scholen? Verandert deze relatie tussen scholen?</em></li>
<li><em>Is er verschil in variatie tussen de regressielijnen van de katholieke en openbare scholen?</em></li>
</ul>
</section>
<section id="aparte-analyses-per-school-lineaire-regressies" class="level1">
<h1>Aparte analyses per school: lineaire regressies</h1>
<p>Nu gaan we aparte analyses per school maken. Wat je moet doen: * Maak een geclusterd dataframe op schoolniveau (<code>nested.df</code>) met een rij van elke school inclusief het dataframe voor de leerlingen van die school.<br>
* Gebruik <code>nested.df</code> en <code>purrr::map</code> om een afzonderlijk lineaire regressiemodel te schatten van wiskundeprestaties op SES in elke school.<br>
* Zet de schattingsresultaten in nieuwe kolommen in het geneste dataframe.<br>
* Visualiseer de schattingsresultaten:<br>
- Verdeling van schattingen van intercept en helling per schoolsector (boxplots).<br>
- Verdeling van schattingen van intercept en helling per schoolgemiddelde SES, per schoolsector (scatterplots).</p>
<p>Dus, schat een lineair model voor uitkomstvariabele <code>mathach</code> zoals voorspeld door ses.dev, apart voor elk van de 160 scholen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Allereerst, nest het studenten dataframe per school</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>nested.df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(school) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Dit creeert een school-niveau dataframe (data rij = school), met in  </span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># schoolrij een student niveau dataframe voor die school.</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>nested.df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 2
# Groups:   school [160]
   school data             
   &lt;fct&gt;  &lt;list&gt;           
 1 1224   &lt;tibble [47 × 7]&gt;
 2 1288   &lt;tibble [25 × 7]&gt;
 3 1296   &lt;tibble [48 × 7]&gt;
 4 1308   &lt;tibble [20 × 7]&gt;
 5 1317   &lt;tibble [48 × 7]&gt;
 6 1358   &lt;tibble [30 × 7]&gt;
 7 1374   &lt;tibble [28 × 7]&gt;
 8 1433   &lt;tibble [35 × 7]&gt;
 9 1436   &lt;tibble [44 × 7]&gt;
10 1461   &lt;tibble [33 × 7]&gt;
# … with 150 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wat zeggen van de rijen en kolommen, wat indiceren ze in elk school dataframe?</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (b.v. [47 x 7])</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># De nested.df$data is een list van dataframes, een voor elke school</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(nested.df<span class="sc">$</span>data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(nested.df<span class="sc">$</span>data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 160</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bv, kijk eens naar de data van school 1224:</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Nog steeds genest</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>nested.df <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(school<span class="sc">==</span><span class="st">"1224"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(school, data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
# Groups:   school [1]
  school data             
  &lt;fct&gt;  &lt;list&gt;           
1 1224   &lt;tibble [47 × 7]&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Niet genest</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>nested.df <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(school<span class="sc">==</span><span class="st">"1224"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(school, data) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 47 × 8
# Groups:   school [1]
   school minority sex       ses mathach mean.ses ses.dev sector
   &lt;fct&gt;  &lt;fct&gt;    &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt; 
 1 1224   No       Female -1.53    5.88    -0.434 -1.09   Public
 2 1224   No       Female -0.588  19.7     -0.434 -0.154  Public
 3 1224   No       Male   -0.528  20.3     -0.434 -0.0936 Public
 4 1224   No       Male   -0.668   8.78    -0.434 -0.234  Public
 5 1224   No       Male   -0.158  17.9     -0.434  0.276  Public
 6 1224   No       Male    0.022   4.58    -0.434  0.456  Public
 7 1224   No       Female -0.618  -2.83    -0.434 -0.184  Public
 8 1224   No       Male   -0.998   0.523   -0.434 -0.564  Public
 9 1224   No       Female -0.888   1.53    -0.434 -0.454  Public
10 1224   No       Male   -0.458  21.5     -0.434 -0.0236 Public
# … with 37 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Of kijk naar het eerste element van nested.df$data</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>nested.df<span class="sc">$</span>data[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 47 × 7
   minority sex       ses mathach mean.ses ses.dev sector
   &lt;fct&gt;    &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt; 
 1 No       Female -1.53    5.88    -0.434 -1.09   Public
 2 No       Female -0.588  19.7     -0.434 -0.154  Public
 3 No       Male   -0.528  20.3     -0.434 -0.0936 Public
 4 No       Male   -0.668   8.78    -0.434 -0.234  Public
 5 No       Male   -0.158  17.9     -0.434  0.276  Public
 6 No       Male    0.022   4.58    -0.434  0.456  Public
 7 No       Female -0.618  -2.83    -0.434 -0.184  Public
 8 No       Male   -0.998   0.523   -0.434 -0.564  Public
 9 No       Female -0.888   1.53    -0.434 -0.454  Public
10 No       Male   -0.458  21.5     -0.434 -0.0236 Public
# … with 37 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dat kan ook met tidyverse syntax</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>nested.df <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract2</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 47 × 7
   minority sex       ses mathach mean.ses ses.dev sector
   &lt;fct&gt;    &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt; 
 1 No       Female -1.53    5.88    -0.434 -1.09   Public
 2 No       Female -0.588  19.7     -0.434 -0.154  Public
 3 No       Male   -0.528  20.3     -0.434 -0.0936 Public
 4 No       Male   -0.668   8.78    -0.434 -0.234  Public
 5 No       Male   -0.158  17.9     -0.434  0.276  Public
 6 No       Male    0.022   4.58    -0.434  0.456  Public
 7 No       Female -0.618  -2.83    -0.434 -0.184  Public
 8 No       Male   -0.998   0.523   -0.434 -0.564  Public
 9 No       Female -0.888   1.53    -0.434 -0.454  Public
10 No       Male   -0.458  21.5     -0.434 -0.0236 Public
# … with 37 more rows</code></pre>
</div>
</div>
<p>In plaats van het geneste dataframe te gebruiken, kunnen we nu een aparte linaire regressiemodel fitten in elk dataframe van een school (elk element van nested.df$data).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>lmodels <span class="ot">&lt;-</span> nested.df <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Krijg alle school dataframes</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run lm() voor elk via map</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span> <span class="fu">lm</span>(mathach <span class="sc">~</span> ses.dev, <span class="at">data=</span> .x))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Let op voor de formule notatie in purrr::map(), waar elke .x een element indiceert van </span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># nested.df$data.</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># lmodels is nu een list van gedraaide lineaire modellen, een voor elke school</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lmodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]

Call:
lm(formula = mathach ~ ses.dev, data = .x)

Coefficients:
(Intercept)      ses.dev  
      9.715        2.509  


[[2]]

Call:
lm(formula = mathach ~ ses.dev, data = .x)

Coefficients:
(Intercept)      ses.dev  
     13.511        3.255  


[[3]]

Call:
lm(formula = mathach ~ ses.dev, data = .x)

Coefficients:
(Intercept)      ses.dev  
      7.636        1.076  


[[4]]

Call:
lm(formula = mathach ~ ses.dev, data = .x)

Coefficients:
(Intercept)      ses.dev  
     16.256        0.126  


[[5]]

Call:
lm(formula = mathach ~ ses.dev, data = .x)

Coefficients:
(Intercept)      ses.dev  
     13.178        1.274  


[[6]]

Call:
lm(formula = mathach ~ ses.dev, data = .x)

Coefficients:
(Intercept)      ses.dev  
     11.206        5.068  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(lmodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(lmodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 160</code></pre>
</div>
</div>
<p>In plaats van deze list als een apart object, kunnen we nu een nieuwe kolom maken in nested.df, elk model in een schoolrij van nested.df.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>nested.df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> purrr<span class="sc">::</span><span class="fu">map</span>(data, </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">~</span> <span class="fu">lm</span>(mathach <span class="sc">~</span> ses.dev, <span class="at">data=</span> .x)))</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Resultaat</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>nested.df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 3
# Groups:   school [160]
   school data              model 
   &lt;fct&gt;  &lt;list&gt;            &lt;list&gt;
 1 1224   &lt;tibble [47 × 7]&gt; &lt;lm&gt;  
 2 1288   &lt;tibble [25 × 7]&gt; &lt;lm&gt;  
 3 1296   &lt;tibble [48 × 7]&gt; &lt;lm&gt;  
 4 1308   &lt;tibble [20 × 7]&gt; &lt;lm&gt;  
 5 1317   &lt;tibble [48 × 7]&gt; &lt;lm&gt;  
 6 1358   &lt;tibble [30 × 7]&gt; &lt;lm&gt;  
 7 1374   &lt;tibble [28 × 7]&gt; &lt;lm&gt;  
 8 1433   &lt;tibble [35 × 7]&gt; &lt;lm&gt;  
 9 1436   &lt;tibble [44 × 7]&gt; &lt;lm&gt;  
10 1461   &lt;tibble [33 × 7]&gt; &lt;lm&gt;  
# … with 150 more rows</code></pre>
</div>
</div>
<p>De derde kolom van nested.df ($model) omvat het gedraaide lineaire model voor elke school (oftewel elke rij).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># B.v., model voor school 1224</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>nested.df <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(school<span class="sc">==</span><span class="st">"1224"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract2</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mathach ~ ses.dev, data = .x)

Coefficients:
(Intercept)      ses.dev  
      9.715        2.509  </code></pre>
</div>
</div>
<p>Of het intercept en de slope voor het lineair regressiemodel van school 1224.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>nested.df <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(school<span class="sc">==</span><span class="st">"1224"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Dit is nodig om het lm object te krijgen uit het listobject</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract2</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)     ses.dev 
   9.715447    2.508582 </code></pre>
</div>
</div>
<p>Of, met een tidy-output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>nested.df <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(school<span class="sc">==</span><span class="st">"1224"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract2</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)     9.72      1.10      8.87 1.94e-11
2 ses.dev         2.51      1.77      1.42 1.62e- 1</code></pre>
</div>
</div>
</section>
<section id="laten-we-nu-dezelfde-code-gebruiken-via-mutate-om-opgeschoonde-resultaten-voor-alle-modellen-alle-scholen-te-krijgen" class="level1">
<h1>Laten we nu dezelfde code gebruiken via ‘mutate’ om opgeschoonde resultaten voor alle modellen (alle scholen) te krijgen</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>nested.df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model.results =</span> purrr<span class="sc">::</span><span class="fu">map</span>(model, </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                            broom<span class="sc">::</span>tidy)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>nested.df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 4
# Groups:   school [160]
   school data              model  model.results   
   &lt;fct&gt;  &lt;list&gt;            &lt;list&gt; &lt;list&gt;          
 1 1224   &lt;tibble [47 × 7]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 2 1288   &lt;tibble [25 × 7]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 3 1296   &lt;tibble [48 × 7]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 4 1308   &lt;tibble [20 × 7]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 5 1317   &lt;tibble [48 × 7]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 6 1358   &lt;tibble [30 × 7]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 7 1374   &lt;tibble [28 × 7]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 8 1433   &lt;tibble [35 × 7]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 9 1436   &lt;tibble [44 × 7]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
10 1461   &lt;tibble [33 × 7]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
# … with 150 more rows</code></pre>
</div>
</div>
<p>Gebruik het commando <code>unnest</code> om de resultaten te zien.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>nested.df <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(model.results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 320 × 8
# Groups:   school [160]
   school data              model  term        estimate std.e…¹ stati…²  p.value
   &lt;fct&gt;  &lt;list&gt;            &lt;list&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
 1 1224   &lt;tibble [47 × 7]&gt; &lt;lm&gt;   (Intercept)    9.72    1.10   8.87   1.94e-11
 2 1224   &lt;tibble [47 × 7]&gt; &lt;lm&gt;   ses.dev        2.51    1.77   1.42   1.62e- 1
 3 1288   &lt;tibble [25 × 7]&gt; &lt;lm&gt;   (Intercept)   13.5     1.36   9.91   9.12e-10
 4 1288   &lt;tibble [25 × 7]&gt; &lt;lm&gt;   ses.dev        3.26    2.08   1.57   1.31e- 1
 5 1296   &lt;tibble [48 × 7]&gt; &lt;lm&gt;   (Intercept)    7.64    0.774  9.86   6.27e-13
 6 1296   &lt;tibble [48 × 7]&gt; &lt;lm&gt;   ses.dev        1.08    1.21   0.890  3.78e- 1
 7 1308   &lt;tibble [20 × 7]&gt; &lt;lm&gt;   (Intercept)   16.3     1.40  11.6    9.02e-10
 8 1308   &lt;tibble [20 × 7]&gt; &lt;lm&gt;   ses.dev        0.126   3.00   0.0420 9.67e- 1
 9 1317   &lt;tibble [48 × 7]&gt; &lt;lm&gt;   (Intercept)   13.2     0.790 16.7    3.97e-21
10 1317   &lt;tibble [48 × 7]&gt; &lt;lm&gt;   ses.dev        1.27    1.44   0.887  3.80e- 1
# … with 310 more rows, and abbreviated variable names ¹​std.error, ²​statistic</code></pre>
</div>
</div>
<p>Laten we dat deel vasthouden waarin we geïnteresseerd zijn.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>lm.coeff <span class="ot">&lt;-</span> nested.df <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(model.results) <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(school, term, estimate)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>lm.coeff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 320 × 3
# Groups:   school [160]
   school term        estimate
   &lt;fct&gt;  &lt;chr&gt;          &lt;dbl&gt;
 1 1224   (Intercept)    9.72 
 2 1224   ses.dev        2.51 
 3 1288   (Intercept)   13.5  
 4 1288   ses.dev        3.26 
 5 1296   (Intercept)    7.64 
 6 1296   ses.dev        1.08 
 7 1308   (Intercept)   16.3  
 8 1308   ses.dev        0.126
 9 1317   (Intercept)   13.2  
10 1317   ses.dev        1.27 
# … with 310 more rows</code></pre>
</div>
</div>
<p>Reshape het (maak er een wijd databestand van) en geef het een andere naam.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>lm.coeff <span class="sc">%&lt;&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Model intercept en slope in twee kolommen</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> estimate) <span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Geef de kolommen een andere naam</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(school, <span class="at">intercept =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>, <span class="at">slope =</span> ses.dev)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>lm.coeff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 3
# Groups:   school [160]
   school intercept slope
   &lt;fct&gt;      &lt;dbl&gt; &lt;dbl&gt;
 1 1224        9.72 2.51 
 2 1288       13.5  3.26 
 3 1296        7.64 1.08 
 4 1308       16.3  0.126
 5 1317       13.2  1.27 
 6 1358       11.2  5.07 
 7 1374        9.73 3.85 
 8 1433       19.7  1.85 
 9 1436       18.1  1.60 
10 1461       16.8  6.27 
# … with 150 more rows</code></pre>
</div>
</div>
<p>Voeg variabelen <code>sector</code> (openbaar, katholiek) en <code>mean.ses</code> (gemiddelde ses) toe aan dit dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creeer dataframe met school ID, schoolsector, mean.ses</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>lm.df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(school, sector, mean.ses) <span class="sc">%&gt;%</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  distinct</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>lm.df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 3
   school sector   mean.ses
   &lt;fct&gt;  &lt;fct&gt;       &lt;dbl&gt;
 1 1224   Public    -0.434 
 2 1288   Public     0.122 
 3 1296   Public    -0.426 
 4 1308   Catholic   0.528 
 5 1317   Catholic   0.345 
 6 1358   Public    -0.0197
 7 1374   Public    -0.0126
 8 1433   Catholic   0.712 
 9 1436   Catholic   0.563 
10 1461   Public     0.677 
# … with 150 more rows</code></pre>
</div>
</div>
<p>Combineer dit <code>lm.def</code>-bestand met het bestand <code>lm.coeff</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>(lm.df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(lm.coeff, <span class="at">by=</span><span class="st">"school"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 5
   school sector   mean.ses intercept slope
   &lt;fct&gt;  &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 1224   Public    -0.434       9.72 2.51 
 2 1288   Public     0.122      13.5  3.26 
 3 1296   Public    -0.426       7.64 1.08 
 4 1308   Catholic   0.528      16.3  0.126
 5 1317   Catholic   0.345      13.2  1.27 
 6 1358   Public    -0.0197     11.2  5.07 
 7 1374   Public    -0.0126      9.73 3.85 
 8 1433   Catholic   0.712      19.7  1.85 
 9 1436   Catholic   0.563      18.1  1.60 
10 1461   Public     0.677      16.8  6.27 
# … with 150 more rows</code></pre>
</div>
</div>
<p>Nu kunnen we een boxplot maken van schoolintercepts per schoolsector,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lm.df, <span class="fu">aes</span>(<span class="at">x=</span> sector, <span class="at">y=</span> intercept)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>En ook een boxplot van de slopes van school_SES per schoolsector</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lm.df, <span class="fu">aes</span>(<span class="at">x=</span> sector, <span class="at">y=</span> slope)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Of beide schattingen in een scatterplot per schoolsector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lm.df, <span class="fu">aes</span>(<span class="at">x=</span> intercept, <span class="at">y=</span> slope)) <span class="sc">+</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Scatterplot</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lineaire regressielijn</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Facet per sector</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> sector) <span class="sc">+</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Scatterplots van intercepts voor school <code>mean.ses</code> per sector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lm.df, <span class="fu">aes</span>(<span class="at">x=</span> mean.ses, <span class="at">y=</span> intercept)) <span class="sc">+</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"loess"</span>) <span class="sc">+</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> sector) <span class="sc">+</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Scatterplot van slopes van school <code>mean.ses</code> per sector</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lm.df, <span class="fu">aes</span>(<span class="at">x=</span> mean.ses, <span class="at">y=</span> slope)) <span class="sc">+</span> </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"loess"</span>) <span class="sc">+</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> sector) <span class="sc">+</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Nu kun je op volgende vragen antwoord geven. * <em>In <code>nested.df$data</code>, wat geven de aantallen rijen en kolommen aan in het dataframe van elke school?</em>.<br>
* <em>Welke verschillen zie je tussen de verdeling van de geschatte <em>intercepts</em> in Openbare vs Katholieke scholen? Wat betekent dit inhoudelijk?</em>.<br>
* <em>Welke verschillen zie je tussen de verdeling van de geschatte <em>slopes</em> in openbare vs.&nbsp;katholieke scholen? Hoe interpreteer je dit inhoudelijk?</em>.<br>
* <em>Welke relatie komt naar voren tussen de gemiddelde SES van de school en de geschatte intercept van de school? Hoe zit het met dezelfde relatie voor de geschatte helling van de school? Zijn er in dit opzicht verschillen tussen openbare en katholieke scholen?</em></p>
</section>
<section id="hierarchische-lineair-model-variantie-componenten" class="level1">
<h1>Hierarchische Lineair Model: variantie componenten</h1>
<p>Nu we databestand snappen, en ook zicht hebben op de regressies op schoolniveau en over scholen heen, gaan we over naar multilevel modeleren (een techniek die hier beter zicht op geeft) en we zullen het volgende doen: * Schat een multilevelmodel op twee niveaus met leerlingen (niveau 1) genest in scholen (niveau 2): <code>mod1</code>.<br>
- Dit is een multilevel-model zonder voorspeller, dat eenvoudig <code>matchach</code> variatie verdeelt tussen variatie op leerlingniveau (tussen leerlingen) en variatie op schoolniveau (tussen scholen).<br>
- Hier wordt <code>mathach</code> gemodelleerd als resultaat van een willekeurig effect van de school (groepsniveau) plus een willekeurig effect van de leerling (individueel of restniveau): deze worden respectievelijk <span class="math inline">\(u_i\)</span> en <span class="math inline">\(e_i\)</span> genoemd door <span class="citation" data-cites="rasbash_lemma_2008">(<a href="#ref-rasbash_lemma_2008" role="doc-biblioref">Rasbash, Steele, and Reckie 2008</a>)</span>.<br>
- Net als alle modellen in deze inleiding wordt <code>mod1</code> geschat via Restricted Maximum Likelihood (REML).<br>
* Voer een Likelihood Ratio Test (LRT) uit voor de significantie van schooleffecten, waarbij <code>mod1</code> wordt vergeleken met hetzelfde nul lineaire model (geen voorspeller) zonder rekening te houden met clustering van leerlingen in scholen (d.w.z. een single-level model).<br>
* Kijk ook naar de schattingen voor de variantiecomponenten of random-effectparameters: de variantie op leerlingniveau en de variantie op schoolniveau - respectievelijk <span class="math inline">\(\sigma^2_e\)</span> en <span class="math inline">\(\sigma^2_u\)</span> genoemd door <span class="citation" data-cites="rasbash_lemma_2008">Rasbash, Steele, and Reckie (<a href="#ref-rasbash_lemma_2008" role="doc-biblioref">2008</a>)</span>.<br>
* Gebruik schattingen voor <span class="math inline">\(\sigma^2_e\)</span> en <span class="math inline">\(\sigma^2_u\)</span> om de variantieverdelingscoëfficiënt (VPC) te berekenen:)<br>
- Dit is het deel van de <code>mathach</code> variatie dat toe te schrijven is aan het tweede niveau, dat wil zeggen toe te schrijven aan de verschillen tussen scholen.<br>
- Merk op dat in variantiecomponentenmodellen en random-interceptmodellen (maar niet in random slopemodellen) de VPC hetzelfde is als de Intraclass Correlatiecoëfficiënt (de correlatie tussen <code>mathach</code> van twee willekeurige leerlingen van dezelfde school).</p>
</section>
<section id="e-beginnen-met-een-simpel-variantie-componenten-model" class="level1">
<h1>e beginnen met een simpel variantie componenten model</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mathach <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> school), </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>df)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 is geschat met 'Restricted Maximum Likelihood' (REML) als standaard.</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Je kunt REML=FALSE instellen om ipv Maximum Likelihood (ML) te gebruiken.</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Hier is het resultaat.</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mathach ~ 1 + (1 | school)
   Data: df

REML criterion at convergence: 47116.8

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.0631 -0.7539  0.0267  0.7606  2.7426 

Random effects:
 Groups   Name        Variance Std.Dev.
 school   (Intercept)  8.614   2.935   
 Residual             39.148   6.257   
Number of obs: 7185, groups:  school, 160

Fixed effects:
            Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept)  12.6370     0.2444 156.6473   51.71   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Laten we de resultaten in tidy-formaat afdrukken.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>(mod1.res <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mod1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 8
  effect   group    term            estimate std.error statis…¹    df    p.value
  &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
1 fixed    &lt;NA&gt;     (Intercept)        12.6      0.244     51.7  157.  2.34e-100
2 ran_pars school   sd__(Intercept)     2.93    NA         NA     NA  NA        
3 ran_pars Residual sd__Observation     6.26    NA         NA     NA  NA        
# … with abbreviated variable name ¹​statistic</code></pre>
</div>
</div>
<p>Om significantie van schooleffecten te meten, laten we in ieder geval eens een nul-model (zonder invloed van de school) schatten om vervolgens het multilevel-model met het nulmodel te kunnen vergelijken.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>mod1_sl <span class="ot">&lt;-</span> <span class="fu">lm</span>(mathach <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>df)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Vergelijk de twee modellen met Likelihood Ratio Test (LRT).</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod1, mod1_sl) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>refitting model(s) with ML (instead of REML)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: df
Models:
mod1_sl: mathach ~ 1
mod1: mathach ~ 1 + (1 | school)
        npar   AIC   BIC logLik deviance  Chisq Df Pr(&gt;Chisq)    
mod1_sl    2 48104 48117 -24050    48100                         
mod1       3 47122 47142 -23558    47116 983.92  1  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Wat is de variantie van schoolniveau?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>(sigma2_u <span class="ot">&lt;-</span> mod1.res <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"ran_pars"</span>, group <span class="sc">==</span> <span class="st">"school"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standaard deviatie</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ^2 = Variantie</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.614025</code></pre>
</div>
</div>
<p>Wat is de variantie van het individuele niveau?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>(sigma2_e <span class="ot">&lt;-</span> mod1.res <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"ran_pars"</span>, group <span class="sc">==</span> <span class="st">"Residual"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standaard deviatie</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ^2 = Variantie</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 39.14832</code></pre>
</div>
</div>
<p>Wat is nu het percentage dat toe te schrijven is aan de school (VPC oftewel ICC)?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>sigma2_u<span class="sc">/</span>(sigma2_u <span class="sc">+</span> sigma2_e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1803518</code></pre>
</div>
</div>
<p>Op de volgende vragen kunnen nu antwoorden worden gegeven: * <em>Hoe kunnen we de resultaten van het variantiecomponentenmodel interpreteren?</em><br>
* <em>Wat is het aandeel van de <code>wiskunde</code> variatie dat verklaard wordt door het schoolniveau? Hoe verhoudt dit zich tot de correlatie tussen wiskundescores van twee willekeurige leerlingen op dezelfde school?</em><br>
* <em>Zijn schooleffecten volgens de LRT significant, dat wil zeggen, is het schoolniveau een significante bron van variatie in <code>mathach</code>?</em></p>
</section>
<section id="hierarchisch-lineair-model-random-intercept" class="level1">
<h1>Hierarchisch Lineair Model: random intercept</h1>
<p>Het volgende gaan we doen: * Schat <code>mod2</code>, een random intercept model met ‘fixed slope’ voor individuele student_SES. * Maak schattingen voor vaste effecten (<code>Intercept</code> en <code>ses.dev</code> slope) en voor random-effect parameters. * Dit model is hetzelfde als vorig variantie componenten model, behalve dat <code>mathach</code> nu voor een deel verklaard wordt door individuele student_SES (<code>ses.dev</code>), en het onderverklaarde variantie deel tussen individuele en school random effecten. - De VPC neemt iets toe vergeleken met <code>mod1</code>, dat geeft aan dat een relatief hoger deel van de (onverklaarde) <code>mathach</code> variatie nu verklaard wordt door school: met andere woorden, <code>student_SES</code> snoept een deel van student-niveau variatie dat het vorige <code>mod1</code> toeschreef aan individuele random effecten (<span class="math inline">\(e_i\)</span>). * Er is een serieus debat over en hoe p-waarden te berekenen (en rapporteren) in multilevel modellen: * Zie Ben Bolker’s GLMM FAQ discussie van <a href="http://bbolker.github.io/mixedmodels-misc/glmmFAQ.html#why-doesnt-lme4-display-denominator-degrees-of-freedomp-values-what-other-options-do-i-have">dit onderwerp</a>, en van <a href="http://bbolker.github.io/mixedmodels-misc/glmmFAQ.html#testing-hypotheses">testen van significantie</a> voor multilevel modellen in het algemeen. * Wij gebruiken <a href="https://www.jstatsoft.org/article/view/v082i13"><code>lmerTest</code></a>, de <code>summary</code> functie.</p>
<p>Eerst een random intercept-model met vaste slope met toegevoegde individuele variabele <code>ses.dev</code> (student_SES).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mathach <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> ses.dev <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> school), </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>df)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Zie resultaten.</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mathach ~ 1 + ses.dev + (1 | school)
   Data: df

REML criterion at convergence: 46724

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.0969 -0.7322  0.0194  0.7572  2.9147 

Random effects:
 Groups   Name        Variance Std.Dev.
 school   (Intercept)  8.672   2.945   
 Residual             37.010   6.084   
Number of obs: 7185, groups:  school, 160

Fixed effects:
             Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)   12.6361     0.2445  156.7405   51.68   &lt;2e-16 ***
ses.dev        2.1912     0.1087 7022.0237   20.17   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
        (Intr)
ses.dev 0.000 </code></pre>
</div>
</div>
<p>Een andere optie om significantie te testen van single coefficient schattingen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II Wald chisquare tests)

Response: mathach
         Chisq Df Pr(&gt;Chisq)    
ses.dev 406.68  1  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We kunnen ook de resultaten in tidy-vorm presenteren.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>(mod2.res <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mod2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 8
  effect   group    term            estimate std.error statis…¹    df    p.value
  &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
1 fixed    &lt;NA&gt;     (Intercept)        12.6      0.244     51.7  157.  2.29e-100
2 fixed    &lt;NA&gt;     ses.dev             2.19     0.109     20.2 7022.  5.77e- 88
3 ran_pars school   sd__(Intercept)     2.94    NA         NA     NA  NA        
4 ran_pars Residual sd__Observation     6.08    NA         NA     NA  NA        
# … with abbreviated variable name ¹​statistic</code></pre>
</div>
</div>
<p>We kunnen de fixed-effects (vaste effecten) laten zien (voor intercept en SES).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Zie schattingen estimates voor populatie-niveau fixed effecten: intercept en SES</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>mod2.res <span class="sc">%&gt;%</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"fixed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 8
  effect group term        estimate std.error statistic    df   p.value
  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
1 fixed  &lt;NA&gt;  (Intercept)    12.6      0.244      51.7  157. 2.29e-100
2 fixed  &lt;NA&gt;  ses.dev         2.19     0.109      20.2 7022. 5.77e- 88</code></pre>
</div>
</div>
<p>We kunnen ook de random-effects (op school en individueel niveau) presenteren.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>mod2.res <span class="sc">%&gt;%</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"ran_pars"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 8
  effect   group    term            estimate std.error statistic    df p.value
  &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 ran_pars school   sd__(Intercept)     2.94        NA        NA    NA      NA
2 ran_pars Residual sd__Observation     6.08        NA        NA    NA      NA</code></pre>
</div>
</div>
<p>Dit is schatting van school-niveau variantie.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>(sigma2_u <span class="ot">&lt;-</span> mod2.res <span class="sc">%&gt;%</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"ran_pars"</span>, group <span class="sc">==</span> <span class="st">"school"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standaard deviatie</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ^2 = Variantie</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.672289</code></pre>
</div>
</div>
<p>Dit is schatting van variantie op individueel niveau.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>(sigma2_e <span class="ot">&lt;-</span> mod2.res <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"ran_pars"</span>, group <span class="sc">==</span> <span class="st">"Residual"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standaard deviatie</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ^2 = Variantie</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 37.01041</code></pre>
</div>
</div>
<p>VPC in dit geval.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>sigma2_u<span class="sc">/</span>(sigma2_u <span class="sc">+</span> sigma2_e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1898375</code></pre>
</div>
</div>
<p>Met bovenstaande analyses kun je op volgende vragen antwoord geven: * <em>Hoe kunnen we de schattingen interpreteren voor de fixed-effect parameters?</em> * <em>Hoe kunnen we de schattingen interpreteren voor de variantie componenten? </em> * <em>Gebaseerd op VPC, welk deel van de <code>mathach</code> variatie is <em>niet verklaard</em> door <code>ses.dev</code> is toe te schrijven aan het schoolniveau?</em> - <em>Hoe verschilt dit van de interpretatie van VPC in het variantie componenten model <code>mod1</code>?</em> - <em>Hoe kunnen we toename in VPC interpreteren vergeleken met <code>mod1</code>?</em></p>
</section>
<section id="hierarchisch-lineair-model-random-slope" class="level1">
<h1>Hierarchisch Lineair Model: random slope</h1>
<p>We gaan nog stapje verder door ook te kijken naar het random slope model. Het volgende moet je dan doen:</p>
<ul>
<li>Schat <code>mod3</code>, een random slope model waarin het effect van individuele stduent_SES op wiskundescore mag variëren tussen scholen.<br>
</li>
<li>Bekijk schattingen voor de verschillende random-effect parameters in dit model: variantie van random intercept, variantie van random slope, covariantie tussen random intercept en random slope.<br>
</li>
<li>Deze worden respectievelijk <span class="math inline">\(\sigma^2_{u0}\)</span>, <span class="math inline">\(\sigma^2_{u1}\)</span> en <span class="math inline">\(\sigma_{u01}\)</span> genoemd door <span class="citation" data-cites="rasbash_lemma_2008">Rasbash, Steele, and Reckie (<a href="#ref-rasbash_lemma_2008" role="doc-biblioref">2008</a>)</span>.<br>
</li>
<li>Merk op dat de resultaten van het <code>lme4</code> model de <em>correlatie</em> <span class="math inline">\(\rho_{u01}\)</span> (niet de covariantie) tussen willekeurig intercept en willekeurige slope weergeven: om de covariantie te krijgen vermenigvuldig je gewoon de correlatie met de twee standaarddeviaties (<span class="math inline">\(\rho_{u01}*\sigma_{u0}*\sigma_{u1}\)</span>).</li>
</ul>
<p>Eerst maar random slope model met SES slope die mag varieren tussen scholen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mathach <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> ses.dev <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> ses.dev <span class="sc">|</span> school), </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>df)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Resultaten</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mathach ~ 1 + ses.dev + (1 + ses.dev | school)
   Data: df

REML criterion at convergence: 46714.2

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-3.09680 -0.73193  0.01855  0.75386  2.89924 

Random effects:
 Groups   Name        Variance Std.Dev. Corr
 school   (Intercept)  8.681   2.9464       
          ses.dev      0.694   0.8331   0.02
 Residual             36.700   6.0581       
Number of obs: 7185, groups:  school, 160

Fixed effects:
            Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept)  12.6362     0.2445 156.7512   51.68   &lt;2e-16 ***
ses.dev       2.1932     0.1283 155.2166   17.10   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
        (Intr)
ses.dev 0.009 </code></pre>
</div>
</div>
<p>De resultaten in tidy-vorm.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>(mod3.res <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mod3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  effect   group    term                estim…¹ std.e…² stati…³    df    p.value
  &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;                 &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
1 fixed    &lt;NA&gt;     (Intercept)         12.6      0.245    51.7  157.  2.29e-100
2 fixed    &lt;NA&gt;     ses.dev              2.19     0.128    17.1  155.  1.58e- 37
3 ran_pars school   sd__(Intercept)      2.95    NA        NA     NA  NA        
4 ran_pars school   cor__(Intercept).s…  0.0191  NA        NA     NA  NA        
5 ran_pars school   sd__ses.dev          0.833   NA        NA     NA  NA        
6 ran_pars Residual sd__Observation      6.06    NA        NA     NA  NA        
# … with abbreviated variable names ¹​estimate, ²​std.error, ³​statistic</code></pre>
</div>
</div>
<p>School-niveau variantie van random intercept.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>mod3.res <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"ran_pars"</span>, group <span class="sc">==</span> <span class="st">"school"</span>, term <span class="sc">==</span> <span class="st">"sd__(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standaard deviantie</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ^2 = Variantie</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.681044</code></pre>
</div>
</div>
<p>School-niveau variantie van random SES slope.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>mod3.res <span class="sc">%&gt;%</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"ran_pars"</span>, group <span class="sc">==</span> <span class="st">"school"</span>, term <span class="sc">==</span> <span class="st">"sd__ses.dev"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standaard deviantion</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ^2 = Variantie</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6939974</code></pre>
</div>
</div>
<p>School-niveau correlatie tussen random intercept en random SES slope.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>mod3.res <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"ran_pars"</span>, group <span class="sc">==</span> <span class="st">"school"</span>, term <span class="sc">==</span> <span class="st">"cor__(Intercept).ses.dev"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standaard deviantie</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0190622</code></pre>
</div>
</div>
<p>Op de volgende vragen kun je nu antwoord geven:</p>
<ul>
<li><em>Hoeveel random effect parameters hebben we nu, vergeleken met eerdere modellen? Waarom?</em><br>
</li>
<li><em>Hoe interpreteren we de schattingen voor variantie van random intercept en variantie van random helling?</em><br>
</li>
<li><em>Hoe interpreteren we de geschatte correlatie van random intercept en random helling?</em></li>
</ul>
</section>
<section id="contextuele-variabelen-en-cross-niveau-interacties" class="level1">
<h1>Contextuele variabelen en cross-niveau interacties</h1>
<ul>
<li>We kunnen veronderstellen dat het willekeurige intercept en de willekeurige slope van de school gedeeltelijk worden verklaard door (“contextuele”) variabelen op schoolniveau: bijvoorbeeld <code>mean.ses</code> en <code>sector</code>.<br>
</li>
<li>Dit idee kan worden weergegeven als een random-slope model met <code>mean.ses</code> en <code>sector</code> als hoofdeffecten en interacties met <code>ses.dev</code> (zie de afleiding in de dia’s): <code>mod4</code>.<br>
</li>
<li>Als alternatief kunnen we hetzelfde model schatten maar de <code>ses.dev</code> helling vast houden (d.w.z. een random-intercept model): <code>mod5</code>.<br>
</li>
<li>We testen of <code>mod4</code> significant meer variatie in de afhankelijke variabele verklaart in vergelijking met het eenvoudigere, meer parsimonieuze <code>mod5</code> (Likelihood Ratio Test). - Gebaseerd op LRT resultaten, hebben we geen bewijs om de willekeurige helling te ondersteunen (d.w.z. om de nulhypothese te verwerpen dat de <code>ses.dev</code> helling vast is voor alle scholen), dus kiezen we <code>mod5</code> boven <code>mod4</code>.<br>
</li>
<li>Van <code>mod5</code> verkrijgen we voorspelde waarden van leerling <code>mathach</code> als functie van leerling <code>ses.dev</code>, gegeven verschillende contexten (d.w.z. verschillende vaste waarden van <code>mean.ses</code> en <code>sector</code> van de school). Vervolgens plotten we deze resultaten.</li>
</ul>
<p>Schat het vierde model met interactie tussen <code>mean.ses*ses.dev</code> en <code>sector*ses.dev</code> (contextuele variabelen).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mathach <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mean.ses<span class="sc">*</span>ses.dev <span class="sc">+</span> sector<span class="sc">*</span>ses.dev </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> ses.dev <span class="sc">|</span> school), </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>df)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="co"># zie resultaten</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mathach ~ 1 + mean.ses * ses.dev + sector * ses.dev + (1 + ses.dev |  
    school)
   Data: df

REML criterion at convergence: 46503.7

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-3.15926 -0.72319  0.01704  0.75444  2.95822 

Random effects:
 Groups   Name        Variance Std.Dev. Corr
 school   (Intercept)  2.380   1.5426       
          ses.dev      0.101   0.3179   0.39
 Residual             36.721   6.0598       
Number of obs: 7185, groups:  school, 160

Fixed effects:
                       Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept)             12.1279     0.1993 159.8955  60.856  &lt; 2e-16 ***
mean.ses                 5.3329     0.3692 150.9859  14.446  &lt; 2e-16 ***
ses.dev                  2.9450     0.1556 139.4991  18.928  &lt; 2e-16 ***
sectorCatholic           1.2266     0.3063 149.6127   4.005 9.74e-05 ***
mean.ses:ses.dev         1.0393     0.2989 160.4374   3.477 0.000652 ***
ses.dev:sectorCatholic  -1.6427     0.2398 143.2291  -6.851 2.01e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) men.ss ses.dv sctrCt mn.s:.
mean.ses     0.256                            
ses.dev      0.075  0.019                     
sectorCthlc -0.699 -0.356 -0.053              
mn.ss:ss.dv  0.019  0.074  0.293 -0.026       
ss.dv:sctrC -0.052 -0.027 -0.696  0.077 -0.351</code></pre>
</div>
</div>
<p>Of in tidy-vorm.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 8
   effect   group    term               estim…¹ std.e…² stati…³    df    p.value
   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;                &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
 1 fixed    &lt;NA&gt;     (Intercept)         12.1     0.199   60.9   160.  1.70e-112
 2 fixed    &lt;NA&gt;     mean.ses             5.33    0.369   14.4   151.  2.95e- 30
 3 fixed    &lt;NA&gt;     ses.dev              2.95    0.156   18.9   139.  2.32e- 40
 4 fixed    &lt;NA&gt;     sectorCatholic       1.23    0.306    4.00  150.  9.74e-  5
 5 fixed    &lt;NA&gt;     mean.ses:ses.dev     1.04    0.299    3.48  160.  6.52e-  4
 6 fixed    &lt;NA&gt;     ses.dev:sectorCat…  -1.64    0.240   -6.85  143.  2.01e- 10
 7 ran_pars school   sd__(Intercept)      1.54   NA       NA      NA  NA        
 8 ran_pars school   cor__(Intercept).…   0.391  NA       NA      NA  NA        
 9 ran_pars school   sd__ses.dev          0.318  NA       NA      NA  NA        
10 ran_pars Residual sd__Observation      6.06   NA       NA      NA  NA        
# … with abbreviated variable names ¹​estimate, ²​std.error, ³​statistic</code></pre>
</div>
</div>
<p>Schat in <code>mod5</code> hetzelfde model als <code>mod4</code>, maar zonder random slope (alleen random intercept).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>mod5 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mathach <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mean.ses<span class="sc">*</span>ses.dev <span class="sc">+</span> sector<span class="sc">*</span>ses.dev </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> school), <span class="at">data=</span>df)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Zie resultaten</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mathach ~ 1 + mean.ses * ses.dev + sector * ses.dev + (1 | school)
   Data: df

REML criterion at convergence: 46504.8

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.1701 -0.7249  0.0148  0.7542  2.9655 

Random effects:
 Groups   Name        Variance Std.Dev.
 school   (Intercept)  2.375   1.541   
 Residual             36.766   6.064   
Number of obs: 7185, groups:  school, 160

Fixed effects:
                        Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)              12.1282     0.1992  160.0061  60.885  &lt; 2e-16 ***
mean.ses                  5.3367     0.3690  151.0718  14.463  &lt; 2e-16 ***
ses.dev                   2.9421     0.1512 7018.2611  19.457  &lt; 2e-16 ***
sectorCatholic            1.2245     0.3061  149.6953   4.000 9.92e-05 ***
mean.ses:ses.dev          1.0444     0.2910 7018.2611   3.589 0.000335 ***
ses.dev:sectorCatholic   -1.6422     0.2331 7018.2611  -7.045 2.03e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) men.ss ses.dv sctrCt mn.s:.
mean.ses     0.256                            
ses.dev      0.000  0.000                     
sectorCthlc -0.699 -0.356  0.000              
mn.ss:ss.dv  0.000  0.000  0.295  0.000       
ss.dv:sctrC  0.000  0.000 -0.696  0.000 -0.351</code></pre>
</div>
</div>
<p>In tidy-vorm.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 8
  effect   group    term                estim…¹ std.e…² stati…³    df    p.value
  &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;                 &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
1 fixed    &lt;NA&gt;     (Intercept)           12.1    0.199   60.9   160.  1.40e-112
2 fixed    &lt;NA&gt;     mean.ses               5.34   0.369   14.5   151.  2.62e- 30
3 fixed    &lt;NA&gt;     ses.dev                2.94   0.151   19.5  7018.  3.58e- 82
4 fixed    &lt;NA&gt;     sectorCatholic         1.22   0.306    4.00  150.  9.92e-  5
5 fixed    &lt;NA&gt;     mean.ses:ses.dev       1.04   0.291    3.59 7018.  3.35e-  4
6 fixed    &lt;NA&gt;     ses.dev:sectorCath…   -1.64   0.233   -7.05 7018.  2.03e- 12
7 ran_pars school   sd__(Intercept)        1.54  NA       NA      NA  NA        
8 ran_pars Residual sd__Observation        6.06  NA       NA      NA  NA        
# … with abbreviated variable names ¹​estimate, ²​std.error, ³​statistic</code></pre>
</div>
</div>
<p>Vergelijk de modellen en test het.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod5, mod4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>refitting model(s) with ML (instead of REML)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: df
Models:
mod5: mathach ~ 1 + mean.ses * ses.dev + sector * ses.dev + (1 | school)
mod4: mathach ~ 1 + mean.ses * ses.dev + sector * ses.dev + (1 + ses.dev | school)
     npar   AIC   BIC logLik deviance  Chisq Df Pr(&gt;Chisq)
mod5    8 46513 46568 -23249    46497                     
mod4   10 46516 46585 -23248    46496 1.0016  2     0.6061</code></pre>
</div>
</div>
<p>Op bais van de test (en de waarde van de vastgestelde Chikwadraat statistiek en z’n p-waarde, houden we het random intercept model met vaste slope voor ses.dev aan en kiezen voor : <code>mod5</code></p>
<p>Op basis van <code>mod5</code> voorspellen we de waarden voor <code>ses.dev</code> op verschillende niveaus van <code>sector</code> (schoolsector) en <code>mean.ses</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>pred.val <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(mod5, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"ses.dev"</span>, <span class="st">"mean.ses [-1:0.5 by=0.5]"</span>, <span class="st">"sector"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">ses.dev =</span> x, <span class="at">mathach =</span> predicted, <span class="at">mean.ses =</span> group, <span class="at">sector =</span> facet)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>pred.val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 64 × 7
   ses.dev mathach std.error conf.low conf.high mean.ses sector  
     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;   
 1      -4  -0.799     1.20    -3.15       1.56 -1       Public  
 2      -4   6.99      1.54     3.97      10.0  -1       Catholic
 3      -4  -0.220     0.743   -1.68       1.24 -0.5     Public  
 4      -4   7.57      1.03     5.55       9.60 -0.5     Catholic
 5      -4   0.360     0.637   -0.888      1.61 0        Public  
 6      -4   8.15      0.706    6.77       9.54 0        Catholic
 7      -4   0.939     1.00    -1.03       2.90 0.5      Public  
 8      -4   8.73      0.823    7.12      10.3  0.5      Catholic
 9      -3   1.10      0.934   -0.733      2.93 -1       Public  
10      -3   7.25      1.20     4.90       9.60 -1       Catholic
# … with 54 more rows</code></pre>
</div>
</div>
<p>Plot de voorspelde effecten.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred.val) <span class="sc">+</span> </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lijnen van mathach en ses.dev, gegroepeerd/gekleurd via  sector (Openbaar vs Katholiek)</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mathach, <span class="at">x =</span> ses.dev, <span class="at">group =</span> sector, <span class="at">color =</span> sector)) <span class="sc">+</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verschillende afbeeldingen voor verschillende mean.ses waarden</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> mean.ses) <span class="sc">+</span> </span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li><em>Hoeveel vaste effectparameters hebben we nu, vergeleken met vorige modellen? Waarom? </em><br>
</li>
<li><em>Welke coëfficiëntschattingen zitten wel in <code>mod4</code> maar <em>niet</em> in <code>mod5</code>? Waarom? </em>.<br>
</li>
<li><em>Hoe interpreteren we inhoudelijk de resultaten van de LRT tussen <code>mod4</code> en <code>mod5</code>? </em>.<br>
</li>
<li>_Hoe kunnen we de visualisatie van voorspelde waarden uit <code>mod5</code> interpreteren? Wat is het (fixed) effect van <code>ses.dev</code> op <code>mathach</code>? Hoe verandert dit in katholieke vs.&nbsp;openbare scholen? Hoe verandert dit in scholen waarvan de leerlingenpopulatie gemiddeld een hogere SES heeft?</li>
</ul>
</section>
<section id="school-random-effecten-en-random-intercepten-onderzoeken" class="level1">
<h1>School random effecten en random intercepten onderzoeken</h1>
<ul>
<li>Bereken de schatting voor het vaste intercept op populatieniveau in openbare (<span class="math inline">\(\beta_0\)</span>) en katholieke (<span class="math inline">\(\beta_0+\beta_3\)</span>) scholen (zie dia’s voor coëfficiëntnotatie). Bereken de schattingen voor het willekeurige effect van elke school <span class="math inline">\(j\)</span> <span class="citation" data-cites="rasbash_lemma_2008">(door <a href="#ref-rasbash_lemma_2008" role="doc-biblioref">Rasbash, Steele, and Reckie 2008</a> <span class="math inline">\(u_j\)</span> genoemd)</span>.<br>
</li>
<li>Voeg het vaste intercept toe aan elke <span class="math inline">\(u_j\)</span> om de geschatte realisatie van het willekeurige intercept van elke school te verkrijgen: <span class="math inline">\(u_j\)</span> voor openbare scholen en <span class="math inline">\(u_j\)</span> voor katholieke scholen.<br>
</li>
<li>Dit is de gemiddelde wiskunde-score van de school bij gemiddelde waarden van de voorspellers (ervan uitgaande dat de voorspellers gecentreerd zijn).* Identificeer “beste” scholen op basis van de realisatie van het willekeurige intercept.<br>
</li>
<li>Visualiseer de verdeling van dit willekeurige intercept en het verband met de gemiddelde SES van de school (<code>mean.ses</code>) voor openbare en katholieke scholen.</li>
</ul>
</section>
<section id="geschatte-coefficienten-in-geselecteerde-model" class="level1">
<h1>Geschatte coefficienten in geselecteerde model</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>mod5.res <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mod5)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Krijg vaste parameters van het model</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>mod5.res <span class="sc">%&gt;%</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"fixed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  effect group term                   estimate std.error stati…¹    df   p.value
  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;                     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
1 fixed  &lt;NA&gt;  (Intercept)               12.1      0.199   60.9   160. 1.40e-112
2 fixed  &lt;NA&gt;  mean.ses                   5.34     0.369   14.5   151. 2.62e- 30
3 fixed  &lt;NA&gt;  ses.dev                    2.94     0.151   19.5  7018. 3.58e- 82
4 fixed  &lt;NA&gt;  sectorCatholic             1.22     0.306    4.00  150. 9.92e-  5
5 fixed  &lt;NA&gt;  mean.ses:ses.dev           1.04     0.291    3.59 7018. 3.35e-  4
6 fixed  &lt;NA&gt;  ses.dev:sectorCatholic    -1.64     0.233   -7.05 7018. 2.03e- 12
# … with abbreviated variable name ¹​statistic</code></pre>
</div>
</div>
<p>Vaste intercept.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>mod5.res <span class="sc">%&gt;%</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"fixed"</span>, term <span class="sc">==</span> <span class="st">"(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12.12821</code></pre>
</div>
</div>
<p>Merk op dat Openbare scholen referentie categorie is, voor Katholieke # scholen (dummy variabele=1) moeten we de sectorCatholic parameter toevoegen om het actuele vaste intercept te krijgen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>mod5.res <span class="sc">%&gt;%</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"fixed"</span>, term <span class="sc">==</span> <span class="st">"sectorCatholic"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.224529</code></pre>
</div>
</div>
</section>
<section id="sla-vaste-intercepten-op." class="level1">
<h1>Sla vaste intercepten op.</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vaste intercept voor openbare scholen.</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>(fixed_int_pub <span class="ot">&lt;-</span> mod5.res <span class="sc">%&gt;%</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"fixed"</span>, term <span class="sc">==</span> <span class="st">"(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(estimate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12.12821</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vaste intercept voor katholieke scholen</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>(fixed_slo_cat <span class="ot">&lt;-</span> mod5.res <span class="sc">%&gt;%</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"fixed"</span>, term <span class="sc">==</span> <span class="st">"sectorCatholic"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(estimate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.224529</code></pre>
</div>
</div>
<p>Vaste intercept voor katholieke scholen: beide waarden optellen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>(fixed_int_cat <span class="ot">&lt;-</span> fixed_int_pub <span class="sc">+</span> fixed_slo_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13.35274</code></pre>
</div>
</div>
<p><code>lme4::ranef</code> kan schattingen calculeren voor het intercept random effect model voor elke school.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>lme4<span class="sc">::</span><span class="fu">ranef</span>(mod5) <span class="sc">%&gt;%</span> </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  str</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ school:'data.frame': 160 obs. of  1 variable:
  ..$ (Intercept): num [1:160] -0.0712 0.4531 -1.6798 0.0479 -1.5259 ...
  ..- attr(*, "postVar")= num [1, 1, 1:160] 0.588 0.908 0.579 1.036 0.579 ...
 - attr(*, "class")= chr "ranef.mer"</code></pre>
</div>
</div>
<p>Laat een aantal zien.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ranef</span>(mod5)<span class="sc">$</span>school <span class="sc">%&gt;%</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     (Intercept)
1224 -0.07116497
1288  0.45311618
1296 -1.67981589
1308  0.04791777
1317 -1.52592390
1358 -0.53895146</code></pre>
</div>
</div>
<p>Sla het op als data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>(school.effects <span class="ot">&lt;-</span> <span class="fu">ranef</span>(mod5)<span class="sc">$</span>school <span class="sc">%&gt;%</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"school"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dot wordt soms u_j genoemd.</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">u_j =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>)</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 2
   school     u_j
   &lt;chr&gt;    &lt;dbl&gt;
 1 1224   -0.0712
 2 1288    0.453 
 3 1296   -1.68  
 4 1308    0.0479
 5 1317   -1.53  
 6 1358   -0.539 
 7 1374   -1.50  
 8 1433    1.78  
 9 1436    1.30  
10 1461    0.748 
# … with 150 more rows</code></pre>
</div>
</div>
<p>Merk op dat <code>school</code> naar factor moet worden overgezet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>school.effects <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">school =</span> <span class="fu">factor</span>(school))</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Voeg sector en mean.ses aan het dataframe van random effecten toe.</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Onthoud dat deze variabelen hierin zitten. </span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>lm.df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 5
   school sector   mean.ses intercept slope
   &lt;fct&gt;  &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 1224   Public    -0.434       9.72 2.51 
 2 1288   Public     0.122      13.5  3.26 
 3 1296   Public    -0.426       7.64 1.08 
 4 1308   Catholic   0.528      16.3  0.126
 5 1317   Catholic   0.345      13.2  1.27 
 6 1358   Public    -0.0197     11.2  5.07 
 7 1374   Public    -0.0126      9.73 3.85 
 8 1433   Catholic   0.712      19.7  1.85 
 9 1436   Catholic   0.563      18.1  1.60 
10 1461   Public     0.677      16.8  6.27 
# … with 150 more rows</code></pre>
</div>
</div>
<p>Koppel deze databestanden.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>school.effects <span class="sc">%&lt;&gt;%</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lm.df, <span class="at">by=</span><span class="st">"school"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(school, u_j, sector, mean.ses)</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>school.effects</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 4
   school     u_j sector   mean.ses
   &lt;fct&gt;    &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt;
 1 1224   -0.0712 Public    -0.434 
 2 1288    0.453  Public     0.122 
 3 1296   -1.68   Public    -0.426 
 4 1308    0.0479 Catholic   0.528 
 5 1317   -1.53   Catholic   0.345 
 6 1358   -0.539  Public    -0.0197
 7 1374   -1.50   Public    -0.0126
 8 1433    1.78   Catholic   0.712 
 9 1436    1.30   Catholic   0.563 
10 1461    0.748  Public     0.677 
# … with 150 more rows</code></pre>
</div>
</div>
<p>Voeg een kolom met een vaste intercept-schatting toe. Onthoud dat dit verschillend is voor Katholieke vs Openbare scholen. We gebruiken <code>dplyr::case_when()</code> om vaste intercept schatting te maken voor elke school afhankelijk van de sector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>school.effects <span class="sc">%&lt;&gt;%</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fixed.int =</span> <span class="fu">case_when</span>(</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>    sector <span class="sc">==</span> <span class="st">"Public"</span> <span class="sc">~</span> fixed_int_pub,</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>    sector <span class="sc">==</span> <span class="st">"Catholic"</span> <span class="sc">~</span> fixed_int_cat</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Bekijk resultaten</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>school.effects</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 5
   school     u_j sector   mean.ses fixed.int
   &lt;fct&gt;    &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt;
 1 1224   -0.0712 Public    -0.434       12.1
 2 1288    0.453  Public     0.122       12.1
 3 1296   -1.68   Public    -0.426       12.1
 4 1308    0.0479 Catholic   0.528       13.4
 5 1317   -1.53   Catholic   0.345       13.4
 6 1358   -0.539  Public    -0.0197      12.1
 7 1374   -1.50   Public    -0.0126      12.1
 8 1433    1.78   Catholic   0.712       13.4
 9 1436    1.30   Catholic   0.563       13.4
10 1461    0.748  Public     0.677       12.1
# … with 150 more rows</code></pre>
</div>
</div>
<p>Nu kunnen we de vaste intercept-schattingen aan random effect-schattingen koppelen om de geschatte realisatie van intercept te krijgen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>school.effects <span class="sc">%&lt;&gt;%</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ran.int =</span> fixed.int <span class="sc">+</span> u_j)</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Kijk</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>school.effects</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 6
   school     u_j sector   mean.ses fixed.int ran.int
   &lt;fct&gt;    &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 1224   -0.0712 Public    -0.434       12.1    12.1
 2 1288    0.453  Public     0.122       12.1    12.6
 3 1296   -1.68   Public    -0.426       12.1    10.4
 4 1308    0.0479 Catholic   0.528       13.4    13.4
 5 1317   -1.53   Catholic   0.345       13.4    11.8
 6 1358   -0.539  Public    -0.0197      12.1    11.6
 7 1374   -1.50   Public    -0.0126      12.1    10.6
 8 1433    1.78   Catholic   0.712       13.4    15.1
 9 1436    1.30   Catholic   0.563       13.4    14.7
10 1461    0.748  Public     0.677       12.1    12.9
# … with 150 more rows</code></pre>
</div>
</div>
<p>“Beste” scholen: hoogste waarde van random intercept (gemiddelde wiskunde-score bij gemiddelde waarden van de predictoren).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>school.effects <span class="sc">%&gt;%</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ran.int))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160 × 6
   school   u_j sector   mean.ses fixed.int ran.int
   &lt;fct&gt;  &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 3427    4.21 Catholic    0.153      13.4    17.6
 2 7688    3.17 Catholic    0.186      13.4    16.5
 3 8628    3.13 Catholic   -0.140      13.4    16.5
 4 8193    2.81 Catholic   -0.177      13.4    16.2
 5 9198    2.08 Catholic    0.492      13.4    15.4
 6 2655    3.05 Public     -0.702      12.1    15.2
 7 2629    1.80 Catholic   -0.138      13.4    15.2
 8 1433    1.78 Catholic    0.712      13.4    15.1
 9 4292    1.70 Catholic   -0.486      13.4    15.1
10 2526    1.54 Catholic    0.327      13.4    14.9
# … with 150 more rows</code></pre>
</div>
</div>
<p>Beste onder katholieke scholen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>school.effects <span class="sc">%&gt;%</span> </span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sector<span class="sc">==</span><span class="st">"Catholic"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ran.int))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 70 × 6
   school   u_j sector   mean.ses fixed.int ran.int
   &lt;fct&gt;  &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 3427    4.21 Catholic    0.153      13.4    17.6
 2 7688    3.17 Catholic    0.186      13.4    16.5
 3 8628    3.13 Catholic   -0.140      13.4    16.5
 4 8193    2.81 Catholic   -0.177      13.4    16.2
 5 9198    2.08 Catholic    0.492      13.4    15.4
 6 2629    1.80 Catholic   -0.138      13.4    15.2
 7 1433    1.78 Catholic    0.712      13.4    15.1
 8 4292    1.70 Catholic   -0.486      13.4    15.1
 9 2526    1.54 Catholic    0.327      13.4    14.9
10 3838    1.50 Catholic    0.145      13.4    14.9
# … with 60 more rows</code></pre>
</div>
</div>
<p>Beste onder openbare scholen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>school.effects <span class="sc">%&gt;%</span> </span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sector<span class="sc">==</span><span class="st">"Public"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ran.int))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 90 × 6
   school   u_j sector mean.ses fixed.int ran.int
   &lt;fct&gt;  &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 2655    3.05 Public  -0.702       12.1    15.2
 2 6170    2.11 Public  -0.302       12.1    14.2
 3 6089    2.03 Public   0.0859      12.1    14.2
 4 4420    1.98 Public  -0.224       12.1    14.1
 5 8357    1.80 Public  -0.107       12.1    13.9
 6 5640    1.55 Public  -0.177       12.1    13.7
 7 2336    1.53 Public   0.442       12.1    13.7
 8 1942    1.53 Public   0.682       12.1    13.7
 9 7697    1.49 Public   0.258       12.1    13.6
10 4642    1.48 Public   0.115       12.1    13.6
# … with 80 more rows</code></pre>
</div>
</div>
<p>Visualiseer random intercept verdeling per sector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(school.effects, <span class="fu">aes</span>(<span class="at">x=</span>sector, <span class="at">y=</span> ran.int)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Visualiseer random intercepten bij <code>mean.ses</code> in katholieke vs openbare scholen</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(school.effects, </span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean.ses, <span class="at">y=</span>ran.int, <span class="at">color =</span> sector)) <span class="sc">+</span> </span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Scatterplot geom</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lineaire regressie lijn</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># thema</span></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Bij alles wat we gedaan hebben, moet je antwoord op volgende vraag kunnen geven: * <em>Hoe interpreteren we de laatste twee figuren?</em></p>
</section>
<section id="literatuur" class="level1">
<h1>Literatuur</h1>
<style>
    pre {
        border: 0;
    }
</style>

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-bates_lme4_2012" class="csl-entry" role="listitem">
Bates, Douglas. 2012. <em>Lme4: <span>Mixed</span>-Effects Modeling with <span>R</span></em>. <a href="https://stat.ethz.ch/~maechler/MEMo-pages/lMMwR.pdf">https://stat.ethz.ch/~maechler/MEMo-pages/lMMwR.pdf</a>.
</div>
<div id="ref-bates_fitting_2015" class="csl-entry" role="listitem">
Bates, Douglas, Martin Mächler, Ben Bolker, and Steve Walker. 2015. <span>“Fitting Linear Mixed-Effects Models Using Lme4.”</span> <em>Journal of Statistical Software</em> 67 (1). <a href="https://doi.org/10.18637/jss.v067.i01">https://doi.org/10.18637/jss.v067.i01</a>.
</div>
<div id="ref-finch_multilevel_2014" class="csl-entry" role="listitem">
Finch, W. Holmes, Jocelyn E Bolin, and Ken Kelley. 2014. <em>Multilevel Modeling Using <span>R</span></em>. CRC Press.
</div>
<div id="ref-fox_applied_2016" class="csl-entry" role="listitem">
Fox, John. 2016a. <em>Applied Regression Analysis and Generalized Linear Models</em>. Third Edition. Los Angeles: SAGE.
</div>
<div id="ref-fox_linear_2016" class="csl-entry" role="listitem">
———. 2016b. <span>“Linear <span>Mixed</span>-<span>Effects</span> <span>Models</span> for <span>Hierarchical</span> and <span>Longitudinal</span> <span>Data</span>.”</span> In <em>Applied Regression Analysis and Generalized Linear Models</em>, Third Edition, 700–742. Los Angeles: SAGE.
</div>
<div id="ref-fox_fitting_2018" class="csl-entry" role="listitem">
Fox, John, and Sanford Weisberg. 2018. <span>“Fitting <span>Mixed</span>-<span>Effects</span> <span>Models</span>.”</span> In <em>An <span>R</span> <span>Companion</span> to <span>Applied</span> <span>Regression</span></em>, Third edition, 335–84. Los Angeles, Calif.: SAGE Publications, Inc.
</div>
<div id="ref-gelman_data_2006" class="csl-entry" role="listitem">
Gelman, Andrew, and Jennifer Hill. 2006. <em>Data <span>Analysis</span> <span>Using</span> <span>Regression</span> and <span>Multilevel</span>/<span>Hierarchical</span> <span>Models</span></em>. Cambridge ; New York: Cambridge University Press.
</div>
<div id="ref-goldstein_multilevel_2010" class="csl-entry" role="listitem">
Goldstein, Harvey. 2010. <em>Multilevel <span>Statistical</span> <span>Models</span></em>. 4 edition. Chichester, West Sussex: Wiley.
</div>
<div id="ref-rasbash_lemma_2008" class="csl-entry" role="listitem">
Rasbash, J., F. Steele, and George Reckie. 2008. <em><span>LEMMA</span>: <span>Learning</span> Environment for Multilevel Methodology and Applications</em>. University of Bristol: Centre for Multilevel Modelling. <a href="https://www.cmm.bris.ac.uk/lemma">https://www.cmm.bris.ac.uk/lemma</a>.
</div>
<div id="ref-raudenbush_hierarchical_2002" class="csl-entry" role="listitem">
Raudenbush, Stephen W., and Anthony S. Bryk. 2002. <em>Hierarchical <span>Linear</span> <span>Models</span>: <span>Applications</span> and <span>Data</span> <span>Analysis</span> <span>Methods</span></em>. 2nd edition. Thousand Oaks: SAGE Publications, Inc.
</div>
<div id="ref-simonoff_sage_2013" class="csl-entry" role="listitem">
Simonoff, Jeffrey S., Marc A. Scott, and Brian D. Marx, eds. 2013. <em>The <span>SAGE</span> Handbook of Multilevel Modeling</em>. Los Angeles: SAGE.
</div>
<div id="ref-snijders_multilevel_2012" class="csl-entry" role="listitem">
Snijders, Tom, and R. J. Bosker. 2012. <em>Multilevel Analysis: <span>An</span> Introduction to Basic and Advanced Multilevel Modeling</em>. 2nd edition. London; Thousand Oaks, Calif: SAGE Publications.
</div>
<div id="ref-wickham_r_2017" class="csl-entry" role="listitem">
Wickham, Hadley, and Garrett Grolemund. 2017. <em>R for <span>Data</span> <span>Science</span>: <span>Import</span>, <span>Tidy</span>, <span>Transform</span>, <span>Visualize</span>, and <span>Model</span> <span>Data</span></em>. 1 edition. Sebastopol, CA: O’Reilly Media. <a href="http://r4ds.had.co.nz">http://r4ds.had.co.nz</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>